-- ƒê·∫∑t t√™n: "PVPSystem" trong ServerScriptService
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

-- Kh·ªüi t·∫°o h·ªá th·ªëng PVP
local PVPSystem = {}
PVPSystem.PVPPlayers = {}
PVPSystem.BountyRewards = {Kill = 1000, Assist = 500}

-- T·∫°o Remote Events
local TogglePVPEvent = Instance.new("RemoteEvent")
TogglePVPEvent.Name = "TogglePVPEvent"
TogglePVPEvent.Parent = game.ReplicatedStorage

local PlayerKilledEvent = Instance.new("RemoteEvent")
PlayerKilledEvent.Name = "PlayerKilledEvent"
PlayerKilledEvent.Parent = game.ReplicatedStorage

-- H√†m b·∫≠t/t·∫Øt PVP
function PVPSystem:TogglePVP(player)
    if not PVPSystem.PVPPlayers[player] then
        -- B·∫¨T PVP
        PVPSystem.PVPPlayers[player] = {
            PVPEnabled = true,
            LastCombat = os.time(),
            Bounty = 0,
            Kills = 0,
            Deaths = 0
        }
        
        -- Th√™m tag PVP
        if player.Character then
            local humanoid = player.Character:FindFirstChild("Humanoid")
            if humanoid then
                local pvpTag = Instance.new("BoolValue")
                pvpTag.Name = "PVPEnabled"
                pvpTag.Value = true
                pvpTag.Parent = humanoid
            end
        end
        
        print("‚úÖ " .. player.Name .. " ƒë√£ B·∫¨T PVP")
        return true
    else
        -- T·∫ÆT PVP
        PVPSystem.PVPPlayers[player] = nil
        
        -- X√≥a tag PVP
        if player.Character then
            local humanoid = player.Character:FindFirstChild("Humanoid")
            if humanoid then
                local pvpTag = humanoid:FindFirstChild("PVPEnabled")
                if pvpTag then pvpTag:Destroy() end
            end
        end
        
        print("‚ùå " .. player.Name .. " ƒë√£ T·∫ÆT PVP")
        return false
    end
end

-- H√†m x·ª≠ l√Ω khi player ch·∫øt
function PVPSystem:HandlePlayerDeath(victim, killer)
    if not killer or killer == victim then return end
    
    if PVPSystem.PVPPlayers[victim] and PVPSystem.PVPPlayers[killer] then
        local victimData = PVPSystem.PVPPlayers[victim]
        local killerData = PVPSystem.PVPPlayers[killer]
        
        -- T√≠nh bounty reward
        local bountyReward = math.floor(victimData.Bounty * 0.1) + PVPSystem.BountyRewards.Kill
        
        -- C·∫≠p nh·∫≠t stats
        killerData.Kills = killerData.Kills + 1
        killerData.Bounty = killerData.Bounty + bountyReward
        victimData.Deaths = victimData.Deaths + 1
        
        -- C·∫≠p nh·∫≠t Beli cho killer
        local killerStats = killer:FindFirstChild("leaderstats")
        if killerStats then
            local killerBeli = killerStats:FindFirstChild("Beli")
            if killerBeli then
                killerBeli.Value = killerBeli.Value + bountyReward
            end
        end
        
        -- G·ª≠i th√¥ng b√°o kill
        PlayerKilledEvent:FireAllClients(killer.Name, victim.Name, bountyReward)
        print("‚öîÔ∏è " .. killer.Name .. " ƒë√£ ti√™u di·ªát " .. victim.Name .. " +" .. bountyReward .. " Beli")
    end
end

-- K·∫øt n·ªëi s·ª± ki·ªán
TogglePVPEvent.OnServerEvent:Connect(function(player)
    PVPSystem:TogglePVP(player)
end)

-- Theo d√µi player death
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(character)
        local humanoid = character:WaitForChild("Humanoid")
        humanoid.Died:Connect(function()
            -- T√¨m killer
            local killer = nil
            if humanoid:FindFirstChild("creator") then
                killer = humanoid.creator.Value
            end
            PVPSystem:HandlePlayerDeath(player, killer)
        end)
    end)
end)

-- Auto gi·∫£m bounty sau 5 ph√∫t kh√¥ng combat
RunService.Heartbeat:Connect(function()
    for player, data in pairs(PVPSystem.PVPPlayers) do
        if os.time() - data.LastCombat > 300 then
            data.Bounty = math.floor(data.Bounty * 0.95)
        end
    end
end)
-- ƒê·∫∑t trong Sword tool
local Tool = script.Parent
local Handle = Tool:WaitForChild("Handle")
local Damage = 35
local Cooldown = 1
local CanAttack = true

-- Sound effect
local SlashSound = Instance.new("Sound")
SlashSound.SoundId = "rbxassetid://131429975"
SlashSound.Volume = 0.7
SlashSound.Parent = Handle

Tool.Activated:Connect(function()
    if not CanAttack then return end
    CanAttack = false
    
    SlashSound:Play()
    
    local attacker = game.Players:GetPlayerFromCharacter(Tool.Parent)
    if not attacker then 
        CanAttack = true
        return 
    end
    
    -- Ki·ªÉm tra PVP
    local PVPSystem = game.ServerScriptService:FindFirstChild("PVPSystem")
    if not PVPSystem then 
        CanAttack = true
        return 
    end
    
    local attackerData = PVPSystem.PVPPlayers[attacker]
    if not attackerData then
        print("‚ùå B·∫≠t PVP ƒë·ªÉ t·∫•n c√¥ng ng∆∞·ªùi ch∆°i kh√°c!")
        CanAttack = true
        return
    end
    
    -- C·∫≠p nh·∫≠t combat time
    attackerData.LastCombat = os.time()
    
    -- Animation t·∫•n c√¥ng
    local originalPos = Tool.GripPos
    Tool.GripPos = originalPos + Vector3.new(0, 0, -2)
    wait(0.2)
    Tool.GripPos = originalPos
    
    -- Ph√°t hi·ªán damage
    local character = attacker.Character
    if character then
        local attackerHRP = character:FindFirstChild("HumanoidRootPart")
        if attackerHRP then
            for _, target in pairs(game.Players:GetPlayers()) do
                if target ~= attacker and target.Character then
                    local targetChar = target.Character
                    local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")
                    local targetHumanoid = targetChar:FindFirstChild("Humanoid")
                    
                    if targetHRP and targetHumanoid then
                        local distance = (attackerHRP.Position - targetHRP.Position).Magnitude
                        
                        if distance <= 15 then
                            local targetData = PVPSystem.PVPPlayers[target]
                            if targetData then
                                -- G√¢y damage
                                targetHumanoid:TakeDamage(Damage)
                                
                                -- ƒê√°nh d·∫•u killer
                                local creator = Instance.new("ObjectValue")
                                creator.Name = "creator"
                                creator.Value = attacker
                                creator.Parent = targetHumanoid
                                game.Debris:AddItem(creator, 1)
                                
                                -- C·∫≠p nh·∫≠t combat time cho target
                                targetData.LastCombat = os.time()
                                
                                print("üó°Ô∏è " .. attacker.Name .. " t·∫•n c√¥ng " .. target.Name .. " -" .. Damage .. " HP")
                            end
                        end
                    end
                end
            end
        end
    end
    
    wait(Cooldown)
    CanAttack = true
end)
-- ƒê·∫∑t trong StarterGui > ScreenGui
local Player = game.Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

-- T·∫°o GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "PVPGui"
ScreenGui.Parent = PlayerGui

-- N√∫t b·∫≠t/t·∫Øt PVP
local ToggleButton = Instance.new("TextButton")
ToggleButton.Size = UDim2.new(0, 200, 0, 50)
ToggleButton.Position = UDim2.new(0, 10, 0, 10)
ToggleButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.Text = "PVP: T·∫ÆT"
ToggleButton.TextScaled = true
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.Parent = ScreenGui

-- Hi·ªÉn th·ªã Bounty
local BountyFrame = Instance.new("Frame")
BountyFrame.Size = UDim2.new(0, 200, 0, 80)
BountyFrame.Position = UDim2.new(0, 10, 0, 70)
BountyFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
BountyFrame.Parent = ScreenGui

local BountyLabel = Instance.new("TextLabel")
BountyLabel.Size = UDim2.new(1, 0, 0.5, 0)
BountyLabel.Text = "BOUNTY: 0"
BountyLabel.TextColor3 = Color3.fromRGB(255, 215, 0)
BountyLabel.BackgroundTransparency = 1
BountyLabel.TextScaled = true
BountyLabel.Font = Enum.Font.GothamBold
BountyLabel.Parent = BountyFrame

local StatsLabel = Instance.new("TextLabel")
StatsLabel.Size = UDim2.new(1, 0, 0.5, 0)
StatsLabel.Position = UDim2.new(0, 0, 0.5, 0)
StatsLabel.Text = "Kills: 0 | Deaths: 0"
StatsLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
StatsLabel.BackgroundTransparency = 1
StatsLabel.TextScaled = true
StatsLabel.Parent = BountyFrame

-- Kill Feed
local KillFeed = Instance.new("Frame")
KillFeed.Size = UDim2.new(0, 300, 0, 200)
KillFeed.Position = UDim2.new(1, -310, 0, 10)
KillFeed.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
KillFeed.Parent = ScreenGui

local KillFeedLabel = Instance.new("TextLabel")
KillFeedLabel.Size = UDim2.new(1, 0, 1, 0)
KillFeedLabel.Text = "KILL FEED"
KillFeedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
KillFeedLabel.BackgroundTransparency = 1
KillFeedLabel.TextWrapped = true
KillFeedLabel.TextXAlignment = Enum.TextXAlignment.Left
KillFeedLabel.TextYAlignment = Enum.TextYAlignment.Top
KillFeedLabel.Parent = KillFeed

-- K·∫øt n·ªëi Events
local TogglePVPEvent = game.ReplicatedStorage:WaitForChild("TogglePVPEvent")
local PlayerKilledEvent = game.ReplicatedStorage:WaitForChild("PlayerKilledEvent")

-- B·∫≠t/t·∫Øt PVP
ToggleButton.MouseButton1Click:Connect(function()
    TogglePVPEvent:FireServer()
end)

-- Nh·∫≠n th√¥ng b√°o kill
PlayerKilledEvent.OnClientEvent:Connect(function(killer, victim, bounty)
    local killText = "‚öîÔ∏è " .. killer .. " ƒë√£ ti√™u di·ªát " .. victim .. " +" .. bounty .. " Beli\n"
    KillFeedLabel.Text = killText .. KillFeedLabel.Text
end)

-- C·∫≠p nh·∫≠t Bounty
game:GetService("RunService").Heartbeat:Connect(function()
    local leaderstats = Player:FindFirstChild("leaderstats")
    if leaderstats then
        local bounty = leaderstats:FindFirstChild("Beli")
        if bounty then
            BountyLabel.Text = "BOUNTY: " .. formatNumber(bounty.Value)
        end
    end
end)

function formatNumber(num)
    if num >= 1000000 then
        return string.format("%.1fM", num/1000000)
    elseif num >= 1000 then
        return string.format("%.1fK", num/1000)
    else
        return tostring(num)
    end
end